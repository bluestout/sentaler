{% include 'gravityadmin' %}
<div style="display: none !important;  visibility: hidden !important;" class="cmspro-section" id="cmspro-d38ad2c3"></div>
{% if section.settings.feature_status %}
  <section class="article-heading">
    <div class="article-heading-wrapper">
      {% if  article.metafields["global"]["banner-image"] != blank %}
        <img src="{{ article.metafields["global"]["banner-image"] }}" class="feature_image">
      {% else %}
        <img src="{{ section.settings.feature_banner_image | img_url: '2048x' }}" class="feature_image">
      {% endif %}
    </div>
  </section>
{% endif %}

<!-- ////////////////////////////////   Get Featured collection  ////////////////////////////////////// -->

{% assign article_block = article.content | strip_html | split: 'featured_collection(' %}
{% for article_param in article_block %}

  {% if forloop.index == 2 %}
    {% assign collection_block = article_param | split: ')' %}
    {% for collection_param in collection_block %}
        {% if forloop.index == 1 %}
          {% assign remove_collection_str = collection_param | prepend: '(' | append: ')' %}
          {% assign collection_content = collection_param | split: ' : ' %}
          {% assign title = collection_content[0] %}
          {% assign collection_str = collection_content[1] %}
        {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% capture feature_collection %}
  <div class="content-featured-products row">
    
    {% assign products = collections[collection_str].products %}
    {% if products != blank %}
      <h3 class="text-center">{{ title }}</h3>
      <div class="carousel">
        {% for product_item in products limit: 3 %}
          <div class="col-xs-6 col-sm-6 col-md-4 carousel-cell">
            {% include 'product-item', product:product_item  %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
    
  </div>
{% endcapture %}

<!-- /////////////////////////////////////  End  /////////////////////////////////// -->

<!-- ///////////////////////////  Get Featured Products  /////////////////////////// -->

{% assign article_block = article.content | strip_html | split: 'featured_products(' %}
{% for article_param in article_block %}

  {% if forloop.index == 2 %}
    {% assign products_block = article_param | split: ')' %}
    {% for products_param in products_block %}
        {% if forloop.index == 1 %}
          {% assign remove_products_str = products_param | prepend: '(' | append: ')' %}
          {% assign products_content = products_param | split: ' : ' %}
          {% assign title = products_content[0] %}
          {% assign products_str_array = products_content[1] | split: ',' %}
        {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% capture featured_products %}
  <div class="featured-products row">
    <h3 class="text-center">{{ title }}</h3>
    <div class="row content carousel">
      {% for products_str in products_str_array %}
        {% assign product_block = all_products[products_str] %}
        {% if product_block != blank %}
          <div class="col-xs-6 col-sm-6 col-md-4 carousel-cell">
            {% include 'product-item', product:product_block  %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endcapture %}

<!-- //////////////////////////////////  End  ///////////////////////////////////// -->

<!-- /////////////////////////////  Get Featured Product  ////////////////////////// -->
{% assign article_block = article.content | strip_html | split: 'featured_item(' %}
{% for article_param in article_block %}

  {% if forloop.index == 2 %}
    {% assign product_block = article_param | split: ')' %}
    {% for product_param in product_block %}
        {% if forloop.index == 1 %}
          {% assign remove_product_str = product_param | prepend: '(' | append: ')' %}
          {% assign product_content = product_param | split: ' : ' %}
          {% assign title = product_content[0] %}
          {% assign product_str = product_content[1] %}
        {% endif %}
    {% endfor %}
  {% endif %}

{% endfor %}

{% capture featured_product %}
  <div class="featured-product row">
    {% assign product_block = all_products[product_str] %}
    <h3 class="title">{{ title }}</h3>
    {% if product_block != blank %}
      <div class="col-md-12">
        {% include 'product-item', product:product_block , title: title,  type: 'article_product_detail', quick_shop: true %}
      </div> 
    {% endif %}       
  </div>
{% endcapture %}

<!-- //////////////////////////////////  End  /////////////////////////////////////////// -->

<section class="article-content">
  <div class="article-wrapper">
    <div class="container">
      <div class="row">
        <div class="article-inner">
          {% paginate article.comments by 100 %}

            <div class="col-sm-12 article">
              <!-- Begin article -->
              <div class="heading">
                <h4 class="las_25">{{ article.title }}</h4>
                <p class="lass_17">{{ article.metafields["global"]["sub_title"] }}</p>
                <span>{{ article.author }} | {{ article.updated_at }}</span>
              </div>
              
              <div class="content">
                {% if article.content contains "feature_gallery" %}
                  {% assign feature_gallery = true %}
                  <div class="hide article">{{ article.content }}</div>
                  <div class="featured-gallery">
                    <div class="carousel-main carousel">
                    </div>
                    <div class="carousel-nav carousel">
                    </div>
                  </div>
                {% else %}
                  {% assign content_1 = article.content | remove: remove_collection_str | remove: remove_product_str | remove: remove_products_str %}
                  {% assign content = content_1 | replace: "featured_collection", feature_collection | replace: 'featured_item', featured_product | replace: 'featured_products', featured_products %}
                  {{ content }}
                {% endif %}
              </div>
              <!-- End comments -->
            </div>            
          {% endpaginate %}          
          </div>
        </div>
      </div>
    </div>
</section>
{% if section.settings.blog_recent_show and blog.articles_count > 1 %}
  <section class="related-articles">
    <div class="container">
      <h3 class="sidebar-title text-center">{{ section.settings.blog_recent_title }}</h3>
      <div class="row related-article">
          {% for r_article in blog.articles limit:section.settings.blog_recent_number %}
            {% if r_article.title != article.title%}
                <div class="col-xs-6 col-sm-6 col-md-4 article">
                  <img src="{{ r_article.image | img_url: 'original' }}" class="feature_image">
                  <div class="info">
                    <p class="title lass_17 uppercase">{{ article.title }}</p>
                    {{ article.metafields["global"]["sub_title"] | truncate: 150, "" }}
                    <a href="{{ article.url }}">{{ 'general.accessibility.read_more' | t }}</a>
                  </div>
                </div>
            {% endif %}
          {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

{% schema %}
{
  "name": "Posts",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Show social sharing buttons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "feature_status",
      "label": "Feature banner status"
    },
    {
      "type": "image_picker",
      "id": "feature_banner_image",
      "label": "Feature banner image"
    },
  	{
        "type": "header",
        "content": "Blog Sidebar"
      },
      {
        "type": "checkbox",
        "id": "blog_recent_show",
        "label": "Display this widget?",
        "default": true
      },
      {
        "type": "text",
        "id": "blog_recent_title",
        "label": "Title",
        "default": "Recent articles"
      },
      {
        "type": "blog",
        "id": "blog_recent_blog",
        "label": "Use blog"
      },
      {
        "type": "text",
        "id": "blog_recent_number",
        "label": "Number of",
        "default": "3"
      },
      {
        "type": "paragraph",
        "content": "Sidebar Banner"
      },
      {
        "type": "checkbox",
        "id": "side_banner_show",
        "label": "Sidebar Banner",
        "default": true
      },
      {
        "type": "image_picker",
        "id": "blog_sidebar",
        "label": "Upload image for sale banner",
        "info": "PNG format"
      },
      {
        "type": "image_picker",
        "id": "blog_sidebar2",
        "label": "Upload image for support banner",
        "info": "PNG format"
      }
  ],
  "blocks": [
    {
      "type": "products",
      "name": "Featured products",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    },
    {
      "type": "product",
      "name": "Featured prouduct",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "product worn"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    },
    {
      "type": "collection",
      "name": "Featured collection",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Explore sentailer wrap coats"
        },
        {
          "type": "collection",
          "id": "collection",
          "label": "Collection"
        }
      ]
    }
  ]
}
{% endschema %}
